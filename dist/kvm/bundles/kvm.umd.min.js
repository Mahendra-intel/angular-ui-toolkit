!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports,require("@angular/core"),require("rxjs/operators"),require("@angular/common/http"),require("@open-amt-cloud-toolkit/ui-toolkit/core"),require("rxjs"),require("@angular/material/dialog"),require("@angular/platform-browser"),require("@angular/common"),require("@angular/forms"),require("@angular/material/grid-list"),require("@angular/material/expansion"),require("@angular/material/stepper"),require("@angular/material/chips"),require("@angular/material/core"),require("@angular/material/table"),require("@angular/material/card"),require("@angular/material/list"),require("@angular/material/paginator"),require("@angular/material/sort"),require("@angular/material/checkbox"),require("@angular/material/tooltip"),require("@angular/material/autocomplete"),require("@angular/material/snack-bar"),require("@angular/material/input"),require("@angular/material/form-field"),require("@angular/material/radio"),require("@angular/material/select"),require("@angular/material/slide-toggle"),require("@angular/material/progress-bar"),require("@angular/material/datepicker"),require("@angular/material/progress-spinner"),require("@angular/material/icon"),require("@angular/material/toolbar"),require("@angular/material/sidenav"),require("@angular/material/menu"),require("@angular/material/button"),require("@angular/material/tabs"),require("@angular/material/tree"),require("@angular/material/button-toggle"),require("@angular/flex-layout"),require("@angular/cdk/table")):"function"==typeof define&&define.amd?define("kvm",["exports","@angular/core","rxjs/operators","@angular/common/http","@open-amt-cloud-toolkit/ui-toolkit/core","rxjs","@angular/material/dialog","@angular/platform-browser","@angular/common","@angular/forms","@angular/material/grid-list","@angular/material/expansion","@angular/material/stepper","@angular/material/chips","@angular/material/core","@angular/material/table","@angular/material/card","@angular/material/list","@angular/material/paginator","@angular/material/sort","@angular/material/checkbox","@angular/material/tooltip","@angular/material/autocomplete","@angular/material/snack-bar","@angular/material/input","@angular/material/form-field","@angular/material/radio","@angular/material/select","@angular/material/slide-toggle","@angular/material/progress-bar","@angular/material/datepicker","@angular/material/progress-spinner","@angular/material/icon","@angular/material/toolbar","@angular/material/sidenav","@angular/material/menu","@angular/material/button","@angular/material/tabs","@angular/material/tree","@angular/material/button-toggle","@angular/flex-layout","@angular/cdk/table"],t):t((e="undefined"!=typeof globalThis?globalThis:e||self).kvm={},e.ng.core,e.rxjs.operators,e.ng.common.http,e["@open-amt-cloud-toolkit"]["ui-toolkit"].core,e.rxjs,e.ng.material.dialog,e.ng.platformBrowser,e.ng.common,e.ng.forms,e.ng.material.gridList,e.ng.material.expansion,e.ng.material.stepper,e.ng.material.chips,e.ng.material.core,e.ng.material.table,e.ng.material.card,e.ng.material.list,e.ng.material.paginator,e.ng.material.sort,e.ng.material.checkbox,e.ng.material.tooltip,e.ng.material.autocomplete,e.ng.material.snackBar,e.ng.material.input,e.ng.material.formField,e.ng.material.radio,e.ng.material.select,e.ng.material.slideToggle,e.ng.material.progressBar,e.ng.material.datepicker,e.ng.material.progressSpinner,e.ng.material.icon,e.ng.material.toolbar,e.ng.material.sidenav,e.ng.material.menu,e.ng.material.button,e.ng.material.tabs,e.ng.material.tree,e.ng.material.buttonToggle,e.ng.flexLayout,e.ng.cdk.table)}(this,(function(e,t,o,a,r,n,i,l,u,s,d,M,c,p,m,g,h,v,f,S,b,y,C,w,k,T,D,I,x,q,L,A,E,P,F,B,j,R,N,O,H,K){"use strict";var U={production:!1,mpsServer:"https://localhost/mps",rpsServer:"https://localhost/rps"},_=function(){function e(e){this.http=e,this.connectKVMSocket=new t.EventEmitter(!1),this.stopwebSocket=new t.EventEmitter(!1)}return e.prototype.setAmtFeatures=function(e){return this.http.post(U.mpsServer+"/api/v1/amt/features/"+e,{userConsent:"none",enableKVM:!0,enableSOL:!0,enableIDER:!0}).pipe(o.catchError((function(e){throw e})))},e.prototype.getPowerState=function(e){return this.http.get(U.mpsServer+"/api/v1/amt/power/state/"+e).pipe(o.catchError((function(e){throw e})))},e.prototype.sendPowerAction=function(e,t,a){void 0===a&&(a=!1);var r={method:"PowerAction",action:t,useSOL:a};return this.http.post(U.mpsServer+"/api/v1/amt/power/action/"+e,r).pipe(o.catchError((function(e){throw e})))},e}();_.ɵfac=function(e){return new(e||_)(t.ɵɵinject(a.HttpClient))},_.ɵprov=t.ɵɵdefineInjectable({token:_,factory:_.ɵfac,providedIn:"platform"}),("undefined"==typeof ngDevMode||ngDevMode)&&t.ɵsetClassMetadata(_,[{type:t.Injectable,args:[{providedIn:"platform"}]}],(function(){return[{type:a.HttpClient}]}),null);var G=function(){function e(){}return e.prototype.ngOnInit=function(){},e}();G.ɵfac=function(e){return new(e||G)},G.ɵcmp=t.ɵɵdefineComponent({type:G,selectors:[["amt-power-up-alert"]],decls:0,vars:0,template:function(e,t){},styles:[""]}),("undefined"==typeof ngDevMode||ngDevMode)&&t.ɵsetClassMetadata(G,[{type:t.Component,args:[{selector:"amt-power-up-alert",templateUrl:"./power-up-alert.component.html",styleUrls:["./power-up-alert.component.scss"]}]}],(function(){return[]}),null);var V=function(){function e(e){this.http=e,this.loggedInSubject=new t.EventEmitter(!1),this.isLoggedIn=!1,this.url=U.mpsServer+"/api/v1/authorize",null!=localStorage.loggedInUser&&(this.isLoggedIn=!0,this.loggedInSubject.next(this.isLoggedIn)),U.mpsServer.includes("/mps")&&(this.url=U.mpsServer+"/login/api/v1/authorize")}return e.prototype.getLoggedUserToken=function(){var e=localStorage.getItem("loggedInUser");return JSON.parse(e).token},e}();V.ɵfac=function(e){return new(e||V)(t.ɵɵinject(a.HttpClient))},V.ɵprov=t.ɵɵdefineInjectable({token:V,factory:V.ɵfac,providedIn:"platform"}),("undefined"==typeof ngDevMode||ngDevMode)&&t.ɵsetClassMetadata(V,[{type:t.Injectable,args:[{providedIn:"platform"}]}],(function(){return[{type:a.HttpClient}]}),null);var J=["canvas"],z=function(){function e(e,o,a){var r=this;this.dialog=e,this.authService=o,this.devicesService=a,this.width=400,this.height=400,this.deviceState=0,this.deviceStatus=new t.EventEmitter,this.powerState=0,this.btnText="Disconnect",this.isPoweredOn=!1,this.isLoading=!1,this.deviceId="",this.selected=1,this.server=U.mpsServer.replace("http","ws")+"/relay",this.previousAction="kvm",this.selectedAction="",this.mouseMove=null,this.encodings=[{value:1,viewValue:"RLE 8"},{value:2,viewValue:"RLE 16"}],this.onConnectionStateChange=function(e,t){r.deviceState=t,r.deviceStatus.emit(t)},this.reset=function(){r.redirector=null,r.module=null,r.dataProcessor=null,r.height=400,r.width=400,r.instantiate()},this.stopKvm=function(){r.redirector.stop(),r.keyboardHelper.UnGrabKeyInput(),r.reset()},U.mpsServer.includes("/mps")&&(this.server=U.mpsServer.replace("http","ws")+"/ws/relay")}return e.prototype.ngOnInit=function(){var e=this;this.logger=new r.ConsoleLogger(1),this.stopSocketSubscription=this.devicesService.stopwebSocket.subscribe((function(){e.stopKvm()})),this.startSocketSubscription=this.devicesService.connectKVMSocket.subscribe((function(){e.setAmtFeatures()})),this.timeInterval=n.interval(15e3).pipe(o.mergeMap((function(){return e.devicesService.getPowerState(e.deviceId)}))).subscribe()},e.prototype.ngAfterViewInit=function(){this.setAmtFeatures()},e.prototype.instantiate=function(){var e,t,a=this;this.context=null===(e=this.canvas)||void 0===e?void 0:e.nativeElement.getContext("2d"),this.redirector=new r.AMTKvmDataRedirector(this.logger,r.Protocol.KVM,new FileReader,this.deviceId,16994,"","",0,0,this.authService.getLoggedUserToken(),this.server),this.module=new r.AMTDesktop(this.logger,this.context),this.dataProcessor=new r.DataProcessor(this.logger,this.redirector,this.module),this.mouseHelper=new r.MouseHelper(this.module,this.redirector,200),this.keyboardHelper=new r.KeyBoardHelper(this.module,this.redirector),this.redirector.onProcessData=this.module.processData.bind(this.module),this.redirector.onStart=this.module.start.bind(this.module),this.redirector.onNewState=this.module.onStateChange.bind(this.module),this.redirector.onSendKvmData=this.module.onSendKvmData.bind(this.module),this.redirector.onStateChanged=this.onConnectionStateChange.bind(this),this.redirector.onError=this.onRedirectorError.bind(this),this.module.onSend=this.redirector.send.bind(this.redirector),this.module.onProcessData=this.dataProcessor.processData.bind(this.dataProcessor),this.module.bpp=this.selected,this.mouseMove=n.fromEvent(null===(t=this.canvas)||void 0===t?void 0:t.nativeElement,"mousemove"),this.mouseMove.pipe(o.throttleTime(200)).subscribe((function(e){null!=a.mouseHelper&&a.mouseHelper.mousemove(e)}))},e.prototype.onRedirectorError=function(){this.reset()},e.prototype.init=function(){var e=this;this.devicesService.getPowerState(this.deviceId).pipe(o.catchError((function(){return n.of()})),o.finalize((function(){}))).subscribe((function(t){(e.powerState=t,e.isPoweredOn=e.checkPowerStatus(),e.isPoweredOn)?(e.instantiate(),setTimeout((function(){e.isLoading=!1,e.autoConnect()}),0)):(e.isLoading=!1,e.dialog.open(G).afterClosed().subscribe((function(t){t&&(e.isLoading=!0,e.devicesService.sendPowerAction(e.deviceId,2).pipe().subscribe((function(t){e.instantiate(),setTimeout((function(){e.isLoading=!1,e.autoConnect()}),4e3)})))})))}))},e.prototype.setAmtFeatures=function(){var e=this;this.isLoading=!0,console.log("coming inside in setAmtfeatures"),this.devicesService.setAmtFeatures(this.deviceId).pipe(o.catchError((function(){return e.init(),n.of()})),o.finalize((function(){}))).subscribe((function(){return e.init()}))},e.prototype.autoConnect=function(){null!=this.redirector&&(this.redirector.start(WebSocket),this.keyboardHelper.GrabKeyInput())},e.prototype.onEncodingChange=function(){var e=this;this.stopKvm(),n.timer(1e3).subscribe((function(){e.autoConnect()}))},e.prototype.checkPowerStatus=function(){return 2===this.powerState.powerstate},e.prototype.ngDoCheck=function(){this.selectedAction!==this.previousAction&&(this.previousAction=this.selectedAction)},e.prototype.onMouseup=function(e){null!=this.mouseHelper&&this.mouseHelper.mouseup(e)},e.prototype.onMousedown=function(e){null!=this.mouseHelper&&this.mouseHelper.mousedown(e)},e.prototype.ngOnDestroy=function(){this.timeInterval&&this.timeInterval.unsubscribe(),this.stopKvm(),this.startSocketSubscription&&this.startSocketSubscription.unsubscribe(),this.stopSocketSubscription&&this.stopSocketSubscription.unsubscribe()},e}();z.ɵfac=function(e){return new(e||z)(t.ɵɵdirectiveInject(i.MatDialog),t.ɵɵdirectiveInject(V),t.ɵɵdirectiveInject(_))},z.ɵcmp=t.ɵɵdefineComponent({type:z,selectors:[["amt-kvm"]],viewQuery:function(e,o){if(1&e&&t.ɵɵviewQuery(J,1),2&e){var a;t.ɵɵqueryRefresh(a=t.ɵɵloadQuery())&&(o.canvas=a.first)}},inputs:{width:"width",height:"height"},outputs:{deviceState:"deviceState",deviceStatus:"deviceStatus"},decls:5,vars:2,consts:[[2,"display","block"],["oncontextmenu","return false",1,"canvas",3,"width","height","mouseup","mousedown"],["canvas",""]],template:function(e,o){1&e&&(t.ɵɵelementStart(0,"div"),t.ɵɵelementStart(1,"button",0),t.ɵɵtext(2," connect "),t.ɵɵelementEnd(),t.ɵɵelementStart(3,"canvas",1,2),t.ɵɵlistener("mouseup",(function(e){return o.onMouseup(e)}))("mousedown",(function(e){return o.onMousedown(e)})),t.ɵɵelementEnd(),t.ɵɵelementEnd()),2&e&&(t.ɵɵadvance(3),t.ɵɵproperty("width",o.width)("height",o.height))},encapsulation:2}),("undefined"==typeof ngDevMode||ngDevMode)&&t.ɵsetClassMetadata(z,[{type:t.Component,args:[{selector:"amt-kvm",templateUrl:"./kvm.component.html",styles:[]}]}],(function(){return[{type:i.MatDialog},{type:V},{type:_}]}),{canvas:[{type:t.ViewChild,args:["canvas",{static:!1}]}],width:[{type:t.Input}],height:[{type:t.Input}],deviceState:[{type:t.Output}],deviceStatus:[{type:t.Output}]});var Q=function(){function e(){}return e.prototype.ngOnInit=function(){},e}();Q.ɵfac=function(e){return new(e||Q)},Q.ɵcmp=t.ɵɵdefineComponent({type:Q,selectors:[["amt-device-toolbar"]],decls:6,vars:0,template:function(e,o){1&e&&(t.ɵɵelementStart(0,"div"),t.ɵɵtext(1,"Device Control"),t.ɵɵelementEnd(),t.ɵɵelementStart(2,"div"),t.ɵɵtext(3,"List"),t.ɵɵelementEnd(),t.ɵɵelementStart(4,"button"),t.ɵɵtext(5,"tv"),t.ɵɵelementEnd())},styles:[""]}),("undefined"==typeof ngDevMode||ngDevMode)&&t.ɵsetClassMetadata(Q,[{type:t.Component,args:[{selector:"amt-device-toolbar",templateUrl:"./device-toolbar.component.html",styleUrls:["./device-toolbar.component.css"]}]}],(function(){return[]}),null);var W=function(){function e(){}return e.prototype.ngOnInit=function(){},e}();W.ɵfac=function(e){return new(e||W)},W.ɵcmp=t.ɵɵdefineComponent({type:W,selectors:[["amt-are-you-sure"]],decls:0,vars:0,template:function(e,t){},styles:[""]}),("undefined"==typeof ngDevMode||ngDevMode)&&t.ɵsetClassMetadata(W,[{type:t.Component,args:[{selector:"amt-are-you-sure",templateUrl:"./are-you-sure.component.html",styleUrls:["./are-you-sure.component.scss"]}]}],(function(){return[]}),null);var X=function(){function e(e){this.data=e}return e.prototype.ngOnInit=function(){},e}();X.ɵfac=function(e){return new(e||X)(t.ɵɵdirectiveInject(i.MAT_DIALOG_DATA))},X.ɵcmp=t.ɵɵdefineComponent({type:X,selectors:[["amt-dialog-content"]],decls:0,vars:0,template:function(e,t){},styles:[""]}),("undefined"==typeof ngDevMode||ngDevMode)&&t.ɵsetClassMetadata(X,[{type:t.Component,args:[{selector:"amt-dialog-content",templateUrl:"./dialog-content.component.html",styleUrls:["./dialog-content.component.scss"]}]}],(function(){return[{type:void 0,decorators:[{type:t.Inject,args:[i.MAT_DIALOG_DATA]}]}]}),null);var Y=function(){};Y.ɵfac=function(e){return new(e||Y)},Y.ɵmod=t.ɵɵdefineNgModule({type:Y}),Y.ɵinj=t.ɵɵdefineInjector({providers:[{provide:w.MAT_SNACK_BAR_DEFAULT_OPTIONS,useValue:{duration:3e4,panelClass:["success","mat-elevation-z12"]}}],imports:[[H.FlexLayoutModule,s.ReactiveFormsModule,s.FormsModule,m.MatNativeDateModule,g.MatTableModule,N.MatTreeModule,B.MatMenuModule,K.CdkTableModule,O.MatButtonToggleModule,D.MatRadioModule,S.MatSortModule,b.MatCheckboxModule,y.MatTooltipModule,w.MatSnackBarModule,M.MatExpansionModule,d.MatGridListModule,p.MatChipsModule,I.MatSelectModule,v.MatListModule,h.MatCardModule,C.MatAutocompleteModule,c.MatStepperModule,i.MatDialogModule,F.MatSidenavModule,k.MatInputModule,x.MatSlideToggleModule,L.MatDatepickerModule,q.MatProgressBarModule,A.MatProgressSpinnerModule,P.MatToolbarModule,E.MatIconModule,R.MatTabsModule,T.MatFormFieldModule,j.MatButtonModule,f.MatPaginatorModule],H.FlexLayoutModule,s.ReactiveFormsModule,s.FormsModule,C.MatAutocompleteModule,L.MatDatepickerModule,g.MatTableModule,N.MatTreeModule,E.MatIconModule,S.MatSortModule,O.MatButtonToggleModule,y.MatTooltipModule,d.MatGridListModule,D.MatRadioModule,b.MatCheckboxModule,M.MatExpansionModule,B.MatMenuModule,i.MatDialogModule,w.MatSnackBarModule,v.MatListModule,c.MatStepperModule,p.MatChipsModule,h.MatCardModule,I.MatSelectModule,k.MatInputModule,P.MatToolbarModule,R.MatTabsModule,T.MatFormFieldModule,j.MatButtonModule,q.MatProgressBarModule,A.MatProgressSpinnerModule,x.MatSlideToggleModule,F.MatSidenavModule,f.MatPaginatorModule,K.CdkTableModule,m.MatNativeDateModule]}),("undefined"==typeof ngJitMode||ngJitMode)&&t.ɵɵsetNgModuleScope(Y,{declarations:[W,G,X],imports:[H.FlexLayoutModule,s.ReactiveFormsModule,s.FormsModule,m.MatNativeDateModule,g.MatTableModule,N.MatTreeModule,B.MatMenuModule,K.CdkTableModule,O.MatButtonToggleModule,D.MatRadioModule,S.MatSortModule,b.MatCheckboxModule,y.MatTooltipModule,w.MatSnackBarModule,M.MatExpansionModule,d.MatGridListModule,p.MatChipsModule,I.MatSelectModule,v.MatListModule,h.MatCardModule,C.MatAutocompleteModule,c.MatStepperModule,i.MatDialogModule,F.MatSidenavModule,k.MatInputModule,x.MatSlideToggleModule,L.MatDatepickerModule,q.MatProgressBarModule,A.MatProgressSpinnerModule,P.MatToolbarModule,E.MatIconModule,R.MatTabsModule,T.MatFormFieldModule,j.MatButtonModule,f.MatPaginatorModule],exports:[H.FlexLayoutModule,s.ReactiveFormsModule,s.FormsModule,C.MatAutocompleteModule,L.MatDatepickerModule,g.MatTableModule,N.MatTreeModule,E.MatIconModule,S.MatSortModule,O.MatButtonToggleModule,y.MatTooltipModule,d.MatGridListModule,D.MatRadioModule,b.MatCheckboxModule,M.MatExpansionModule,B.MatMenuModule,i.MatDialogModule,w.MatSnackBarModule,v.MatListModule,c.MatStepperModule,p.MatChipsModule,h.MatCardModule,I.MatSelectModule,k.MatInputModule,P.MatToolbarModule,R.MatTabsModule,T.MatFormFieldModule,j.MatButtonModule,q.MatProgressBarModule,A.MatProgressSpinnerModule,x.MatSlideToggleModule,F.MatSidenavModule,f.MatPaginatorModule,K.CdkTableModule,m.MatNativeDateModule]}),("undefined"==typeof ngDevMode||ngDevMode)&&t.ɵsetClassMetadata(Y,[{type:t.NgModule,args:[{imports:[H.FlexLayoutModule,s.ReactiveFormsModule,s.FormsModule,m.MatNativeDateModule,g.MatTableModule,N.MatTreeModule,B.MatMenuModule,K.CdkTableModule,O.MatButtonToggleModule,D.MatRadioModule,S.MatSortModule,b.MatCheckboxModule,y.MatTooltipModule,w.MatSnackBarModule,M.MatExpansionModule,d.MatGridListModule,p.MatChipsModule,I.MatSelectModule,v.MatListModule,h.MatCardModule,C.MatAutocompleteModule,c.MatStepperModule,i.MatDialogModule,F.MatSidenavModule,k.MatInputModule,x.MatSlideToggleModule,L.MatDatepickerModule,q.MatProgressBarModule,A.MatProgressSpinnerModule,P.MatToolbarModule,E.MatIconModule,R.MatTabsModule,T.MatFormFieldModule,j.MatButtonModule,f.MatPaginatorModule],exports:[H.FlexLayoutModule,s.ReactiveFormsModule,s.FormsModule,C.MatAutocompleteModule,L.MatDatepickerModule,g.MatTableModule,N.MatTreeModule,E.MatIconModule,S.MatSortModule,O.MatButtonToggleModule,y.MatTooltipModule,d.MatGridListModule,D.MatRadioModule,b.MatCheckboxModule,M.MatExpansionModule,B.MatMenuModule,i.MatDialogModule,w.MatSnackBarModule,v.MatListModule,c.MatStepperModule,p.MatChipsModule,h.MatCardModule,I.MatSelectModule,k.MatInputModule,P.MatToolbarModule,R.MatTabsModule,T.MatFormFieldModule,j.MatButtonModule,q.MatProgressBarModule,A.MatProgressSpinnerModule,x.MatSlideToggleModule,F.MatSidenavModule,f.MatPaginatorModule,K.CdkTableModule,m.MatNativeDateModule],providers:[{provide:w.MAT_SNACK_BAR_DEFAULT_OPTIONS,useValue:{duration:3e4,panelClass:["success","mat-elevation-z12"]}}],declarations:[W,G,X]}]}],null,null);var Z=function(){function e(){}return e.forRoot=function(){return{ngModule:e,providers:[]}},e}();Z.ɵfac=function(e){return new(e||Z)},Z.ɵmod=t.ɵɵdefineNgModule({type:Z}),Z.ɵinj=t.ɵɵdefineInjector({imports:[[u.CommonModule,Y],Y]}),("undefined"==typeof ngJitMode||ngJitMode)&&t.ɵɵsetNgModuleScope(Z,{imports:[u.CommonModule,Y],exports:[Y]}),("undefined"==typeof ngDevMode||ngDevMode)&&t.ɵsetClassMetadata(Z,[{type:t.NgModule,args:[{declarations:[],exports:[Y],imports:[u.CommonModule,Y]}]}],null,null);var $=function(){};$.ɵfac=function(e){return new(e||$)},$.ɵmod=t.ɵɵdefineNgModule({type:$}),$.ɵinj=t.ɵɵdefineInjector({providers:[V,_],imports:[[a.HttpClientModule,l.BrowserModule,Z.forRoot()]]}),("undefined"==typeof ngJitMode||ngJitMode)&&t.ɵɵsetNgModuleScope($,{declarations:[z,Q],imports:[a.HttpClientModule,l.BrowserModule,Z],exports:[z]}),("undefined"==typeof ngDevMode||ngDevMode)&&t.ɵsetClassMetadata($,[{type:t.NgModule,args:[{declarations:[z,Q],imports:[a.HttpClientModule,l.BrowserModule,Z.forRoot()],exports:[z],schemas:[t.CUSTOM_ELEMENTS_SCHEMA],providers:[V,_]}]}],null,null),e.KvmComponent=z,e.KvmModule=$,e.KvmService=_,Object.defineProperty(e,"__esModule",{value:!0})}));
//# sourceMappingURL=kvm.umd.min.js.map