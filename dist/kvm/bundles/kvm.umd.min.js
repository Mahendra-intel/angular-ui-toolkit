!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports,require("@angular/core"),require("rxjs/operators"),require("@angular/common/http"),require("@open-amt-cloud-toolkit/ui-toolkit/core"),require("rxjs"),require("@angular/platform-browser")):"function"==typeof define&&define.amd?define("kvm",["exports","@angular/core","rxjs/operators","@angular/common/http","@open-amt-cloud-toolkit/ui-toolkit/core","rxjs","@angular/platform-browser"],t):t((e="undefined"!=typeof globalThis?globalThis:e||self).kvm={},e.ng.core,e.rxjs.operators,e.ng.common.http,e["@open-amt-cloud-toolkit"]["ui-toolkit"].core,e.rxjs,e.ng.platformBrowser)}(this,(function(e,t,o,n,i,r,s){"use strict";var c={production:!1,mpsServer:"https://localhost/mps",rpsServer:"https://localhost/rps"},a=function(){function e(e){this.http=e,this.connectKVMSocket=new t.EventEmitter(!1),this.stopwebSocket=new t.EventEmitter(!1)}return e.prototype.setAmtFeatures=function(e){return this.http.post(c.mpsServer+"/api/v1/amt/features/"+e,{userConsent:"none",enableKVM:!0,enableSOL:!0,enableIDER:!0}).pipe(o.catchError((function(e){throw e})))},e.prototype.getPowerState=function(e){return this.http.get(c.mpsServer+"/api/v1/amt/power/state/"+e).pipe(o.catchError((function(e){throw e})))},e}();a.ɵfac=function(e){return new(e||a)(t.ɵɵinject(n.HttpClient))},a.ɵprov=t.ɵɵdefineInjectable({token:a,factory:a.ɵfac,providedIn:"platform"}),("undefined"==typeof ngDevMode||ngDevMode)&&t.ɵsetClassMetadata(a,[{type:t.Injectable,args:[{providedIn:"platform"}]}],(function(){return[{type:n.HttpClient}]}),null);var u=["canvas"],d=function(){function e(e){var o=this;this.devicesService=e,this.width=400,this.height=400,this.deviceState=0,this.deviceStatus=new t.EventEmitter,this.powerState=0,this.btnText="Disconnect",this.isPoweredOn=!1,this.isLoading=!1,this.deviceId="",this.selected=1,this.server=c.mpsServer.replace("http","ws")+"/relay",this.previousAction="kvm",this.selectedAction="",this.mouseMove=null,this.encodings=[{value:1,viewValue:"RLE 8"},{value:2,viewValue:"RLE 16"}],this.onConnectionStateChange=function(e,t){o.deviceState=t,o.deviceStatus.emit(t)},this.reset=function(){o.redirector=null,o.module=null,o.dataProcessor=null,o.height=400,o.width=400,o.instantiate()},this.stopKvm=function(){o.redirector.stop(),o.keyboardHelper.UnGrabKeyInput(),o.reset()},c.mpsServer.includes("/mps")&&(this.server=c.mpsServer.replace("http","ws")+"/ws/relay")}return e.prototype.ngOnInit=function(){var e=this;this.logger=new i.ConsoleLogger(1),this.stopSocketSubscription=this.devicesService.stopwebSocket.subscribe((function(){e.stopKvm()})),this.startSocketSubscription=this.devicesService.connectKVMSocket.subscribe((function(){e.setAmtFeatures()})),this.timeInterval=r.interval(15e3).pipe(o.mergeMap((function(){return e.devicesService.getPowerState(e.deviceId)}))).subscribe()},e.prototype.ngAfterViewInit=function(){this.setAmtFeatures()},e.prototype.instantiate=function(){var e,t,n=this;this.context=null===(e=this.canvas)||void 0===e?void 0:e.nativeElement.getContext("2d"),this.redirector=new i.AMTKvmDataRedirector(this.logger,i.Protocol.KVM,new FileReader,this.deviceId,16994,"","",0,0,this.server),this.module=new i.AMTDesktop(this.logger,this.context),this.dataProcessor=new i.DataProcessor(this.logger,this.redirector,this.module),this.mouseHelper=new i.MouseHelper(this.module,this.redirector,200),this.keyboardHelper=new i.KeyBoardHelper(this.module,this.redirector),this.redirector.onProcessData=this.module.processData.bind(this.module),this.redirector.onStart=this.module.start.bind(this.module),this.redirector.onNewState=this.module.onStateChange.bind(this.module),this.redirector.onSendKvmData=this.module.onSendKvmData.bind(this.module),this.redirector.onStateChanged=this.onConnectionStateChange.bind(this),this.redirector.onError=this.onRedirectorError.bind(this),this.module.onSend=this.redirector.send.bind(this.redirector),this.module.onProcessData=this.dataProcessor.processData.bind(this.dataProcessor),this.module.bpp=this.selected,this.mouseMove=r.fromEvent(null===(t=this.canvas)||void 0===t?void 0:t.nativeElement,"mousemove"),this.mouseMove.pipe(o.throttleTime(200)).subscribe((function(e){null!=n.mouseHelper&&n.mouseHelper.mousemove(e)}))},e.prototype.onRedirectorError=function(){this.reset()},e.prototype.init=function(){var e=this;this.devicesService.getPowerState(this.deviceId).pipe(o.catchError((function(){return r.of()})),o.finalize((function(){}))).subscribe((function(t){e.powerState=t,e.isPoweredOn=e.checkPowerStatus(),e.isPoweredOn?(e.instantiate(),setTimeout((function(){e.isLoading=!1,e.autoConnect()}),0)):e.isLoading=!1}))},e.prototype.setAmtFeatures=function(){var e=this;this.isLoading=!0,console.log("coming inside in setAmtfeatures"),this.devicesService.setAmtFeatures(this.deviceId).pipe(o.catchError((function(){return e.init(),r.of()})),o.finalize((function(){}))).subscribe((function(){return e.init()}))},e.prototype.autoConnect=function(){null!=this.redirector&&(this.redirector.start(WebSocket),this.keyboardHelper.GrabKeyInput())},e.prototype.checkPowerStatus=function(){return 2===this.powerState.powerstate},e.prototype.ngDoCheck=function(){this.selectedAction!==this.previousAction&&(this.previousAction=this.selectedAction)},e.prototype.onMouseup=function(e){null!=this.mouseHelper&&this.mouseHelper.mouseup(e)},e.prototype.onMousedown=function(e){null!=this.mouseHelper&&this.mouseHelper.mousedown(e)},e}();d.ɵfac=function(e){return new(e||d)(t.ɵɵdirectiveInject(a))},d.ɵcmp=t.ɵɵdefineComponent({type:d,selectors:[["amt-kvm"]],viewQuery:function(e,o){if(1&e&&t.ɵɵviewQuery(u,1),2&e){var n;t.ɵɵqueryRefresh(n=t.ɵɵloadQuery())&&(o.canvas=n.first)}},inputs:{width:"width",height:"height"},outputs:{deviceState:"deviceState",deviceStatus:"deviceStatus"},decls:5,vars:2,consts:[[2,"display","block"],["oncontextmenu","return false",1,"canvas",3,"width","height","mouseup","mousedown"],["canvas",""]],template:function(e,o){1&e&&(t.ɵɵelementStart(0,"div"),t.ɵɵelementStart(1,"button",0),t.ɵɵtext(2," connect "),t.ɵɵelementEnd(),t.ɵɵelementStart(3,"canvas",1,2),t.ɵɵlistener("mouseup",(function(e){return o.onMouseup(e)}))("mousedown",(function(e){return o.onMousedown(e)})),t.ɵɵelementEnd(),t.ɵɵelementEnd()),2&e&&(t.ɵɵadvance(3),t.ɵɵproperty("width",o.width)("height",o.height))},encapsulation:2}),("undefined"==typeof ngDevMode||ngDevMode)&&t.ɵsetClassMetadata(d,[{type:t.Component,args:[{selector:"amt-kvm",templateUrl:"./kvm.component.html",styles:[]}]}],(function(){return[{type:a}]}),{canvas:[{type:t.ViewChild,args:["canvas",{static:!1}]}],width:[{type:t.Input}],height:[{type:t.Input}],deviceState:[{type:t.Output}],deviceStatus:[{type:t.Output}]});var l=function(){function e(){}return e.prototype.ngOnInit=function(){},e}();l.ɵfac=function(e){return new(e||l)},l.ɵcmp=t.ɵɵdefineComponent({type:l,selectors:[["amt-device-toolbar"]],decls:6,vars:0,template:function(e,o){1&e&&(t.ɵɵelementStart(0,"div"),t.ɵɵtext(1,"Device Control"),t.ɵɵelementEnd(),t.ɵɵelementStart(2,"div"),t.ɵɵtext(3,"List"),t.ɵɵelementEnd(),t.ɵɵelementStart(4,"button"),t.ɵɵtext(5,"tv"),t.ɵɵelementEnd())},styles:[""]}),("undefined"==typeof ngDevMode||ngDevMode)&&t.ɵsetClassMetadata(l,[{type:t.Component,args:[{selector:"amt-device-toolbar",templateUrl:"./device-toolbar.component.html",styleUrls:["./device-toolbar.component.css"]}]}],(function(){return[]}),null);var p=function(){};p.ɵfac=function(e){return new(e||p)},p.ɵmod=t.ɵɵdefineNgModule({type:p}),p.ɵinj=t.ɵɵdefineInjector({providers:[],imports:[[n.HttpClientModule,s.BrowserModule]]}),("undefined"==typeof ngJitMode||ngJitMode)&&t.ɵɵsetNgModuleScope(p,{declarations:[d,l],imports:[n.HttpClientModule,s.BrowserModule],exports:[d]}),("undefined"==typeof ngDevMode||ngDevMode)&&t.ɵsetClassMetadata(p,[{type:t.NgModule,args:[{declarations:[d,l],imports:[n.HttpClientModule,s.BrowserModule],exports:[d],schemas:[t.CUSTOM_ELEMENTS_SCHEMA],providers:[]}]}],null,null),e.KvmComponent=d,e.KvmModule=p,e.KvmService=a,Object.defineProperty(e,"__esModule",{value:!0})}));
//# sourceMappingURL=kvm.umd.min.js.map