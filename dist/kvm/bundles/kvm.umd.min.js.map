{"version":3,"sources":["../../../projects/kvm/src/environments/environment.ts","../../../projects/kvm/src/lib/kvm.service.ts","../../../projects/kvm/src/lib/auth.service.ts","../../../projects/kvm/src/lib/kvm.component.ts","../../../projects/kvm/src/lib/kvm.component.html","../../../projects/kvm/src/lib/app/device-toolbar/device-toolbar.component.ts","../../../projects/kvm/src/lib/app/device-toolbar/device-toolbar.component.html","../../../projects/kvm/src/lib/kvm.module.ts"],"names":["environment","production","mpsServer","rpsServer","KvmService","http","this","connectKVMSocket","EventEmitter","stopwebSocket","prototype","setAmtFeatures","deviceId","post","userConsent","enableKVM","enableSOL","enableIDER","pipe","catchError","err","getPowerState","get","sendPowerAction","action","useSOL","payload","method","i0","ɵɵinject","i1","HttpClient","factory","ɵfac","providedIn","Injectable","AuthService","loggedInSubject","isLoggedIn","url","localStorage","loggedInUser","next","includes","getLoggedUserToken","loggedUser","getItem","JSON","parse","token","KvmComponent","authService","devicesService","activatedRoute","_this","width","height","deviceState","deviceStatus","powerState","btnText","isPoweredOn","isLoading","selected","server","replace","previousAction","selectedAction","mouseMove","encodings","value","viewValue","onConnectionStateChange","redirector","state","emit","reset","module","dataProcessor","instantiate","stopKvm","stop","keyboardHelper","UnGrabKeyInput","ngOnInit","logger","ConsoleLogger","params","subscribe","id","stopSocketSubscription","startSocketSubscription","timeInterval","interval","mergeMap","ngAfterViewInit","context","_a","canvas","nativeElement","getContext","AMTKvmDataRedirector","Protocol","KVM","FileReader","AMTDesktop","DataProcessor","mouseHelper","MouseHelper","KeyBoardHelper","onProcessData","processData","bind","onStart","start","onNewState","onStateChange","onSendKvmData","onStateChanged","onError","onRedirectorError","onSend","send","bpp","fromEvent","_b","throttleTime","event","mousemove","init","of","finalize","data","checkPowerStatus","setTimeout","autoConnect","console","log","WebSocket","GrabKeyInput","onEncodingChange","timer","powerstate","ngDoCheck","onMouseup","mouseup","onMousedown","mousedown","ngOnDestroy","unsubscribe","ɵɵdirectiveInject","i3","ActivatedRoute","selectors","viewQuery","rf","ctx","i0.ɵɵelementStart","i0.ɵɵtext","i0.ɵɵelementEnd","i0.ɵɵlistener","$event","i0.ɵɵadvance","i0.ɵɵproperty","Component","selector","templateUrl","styles","ViewChild","static","Input","Output","DeviceToolbarComponent","decls","vars","template","styleUrls","KvmModule","imports","HttpClientModule","BrowserModule","declarations","exports","NgModule","schemas","CUSTOM_ELEMENTS_SCHEMA","providers"],"mappings":"gvBAAO,IAAMA,EAAc,CACvBC,YAAY,EACZC,UAAW,wBACXC,UAAW,sCCWb,SAAAC,EAA6BC,GAAAC,KAAAD,KAAAA,EAH7BC,KAAAC,iBAA0C,IAAIC,EAAAA,cAAsB,GACpEF,KAAAG,cAAuC,IAAID,EAAAA,cAAsB,UAIjEJ,EAAAM,UAAAC,eAAA,SAAeC,GAOb,OAAON,KAAKD,KACTQ,KACIb,EAAYE,UAAS,wBAAwBU,EARpC,CACdE,YAAa,OACbC,WAAW,EACXC,WAAW,EACXC,YAAY,IAOXC,KACCC,EAAAA,YAAW,SAACC,GACV,MAAMA,OAIdhB,EAAAM,UAAAW,cAAA,SAAcT,GACZ,OAAON,KAAKD,KACTiB,IACItB,EAAYE,UAAS,2BAA2BU,GAEpDM,KACCC,EAAAA,YAAW,SAACC,GACV,MAAMA,OAIdhB,EAAAM,UAAAa,gBAAA,SACEX,EACAY,EACAC,QAAA,IAAAA,IAAAA,GAAA,GAEA,IAAMC,EAAU,CACdC,OAAQ,cACRH,OAAMA,EACNC,OAAMA,GAER,OAAOnB,KAAKD,KACTQ,KACIb,EAAYE,UAAS,4BAA4BU,EACpDc,GAEDR,KACCC,EAAAA,YAAW,SAACC,GACV,MAAMA,6CApDHhB,GAAUwB,EAAAC,SAAAC,EAAAC,kDAAV3B,EAAU4B,QAAV5B,EAAU6B,KAAAC,WAFT,6EAED9B,EAAU,CAAA,MAHtB+B,EAAAA,iBAAW,CACVD,WAAY,+DCDd,IAAAE,EAAA,WAKE,SAAAA,EAA6B/B,GAAAC,KAAAD,KAAAA,EAJ7BC,KAAA+B,gBAAyC,IAAI7B,EAAAA,cAAsB,GACnEF,KAAAgC,YAAa,EACbhC,KAAAiC,IAAiBvC,EAAYE,UAAS,oBAGH,MAA7BsC,aAAaC,eACfnC,KAAKgC,YAAa,EAClBhC,KAAK+B,gBAAgBK,KAAKpC,KAAKgC,aAE7BtC,EAAYE,UAAUyC,SAAS,UAEjCrC,KAAKiC,IAASvC,EAAYE,UAAS,kCAIvCkC,EAAA1B,UAAAkC,mBAAA,WACE,IAAMC,EAAkBL,aAAaM,QAAQ,gBAE7C,OADsBC,KAAKC,MAAMH,GAAYI,SAlBjD,oCAAab,GAAWR,EAAAC,SAAAC,EAAAC,kDAAXK,EAAWJ,QAAXI,EAAWH,KAAAC,WAFV,6EAEDE,EAAW,CAAA,MAHvBD,EAAAA,iBAAW,CACVD,WAAY,6FCqEZ,SAAAgB,EAGmBC,EACAC,EACDC,GALlB,IAAAC,EAAAhD,KAGmBA,KAAA6C,YAAAA,EACA7C,KAAA8C,eAAAA,EACD9C,KAAA+C,eAAAA,EAlCF/C,KAAAiD,MAAQ,IACRjD,KAAAkD,OAAS,IACflD,KAAAmD,YAAsB,EACtBnD,KAAAoD,aAAqC,IAAIlD,EAAAA,aASnDF,KAAAqD,WAAkB,EAClBrD,KAAAsD,QAAkB,aAClBtD,KAAAuD,aAAuB,EACvBvD,KAAAwD,WAAqB,EACrBxD,KAAAM,SAAmB,GACnBN,KAAAyD,SAAmB,EAEnBzD,KAAA0D,OAAoBhE,EAAYE,UAAU+D,QAAQ,OAAQ,MAAK,SAC/D3D,KAAA4D,eAAiB,MACjB5D,KAAA6D,eAAiB,GACjB7D,KAAA8D,UAAiB,KAEjB9D,KAAA+D,UAAY,CACV,CAAEC,MAAO,EAAGC,UAAW,SACvB,CAAED,MAAO,EAAGC,UAAW,WAmFzBjE,KAAAkE,wBAA0B,SAACC,EAAiBC,GAC1CpB,EAAKG,YAAciB,EACnBpB,EAAKI,aAAaiB,KAAKD,IAmFzBpE,KAAAsE,MAAQ,WACNtB,EAAKmB,WAAa,KAClBnB,EAAKuB,OAAS,KACdvB,EAAKwB,cAAgB,KACrBxB,EAAKE,OAAS,IACdF,EAAKC,MAAQ,IACbD,EAAKyB,eAGPzE,KAAA0E,QAAU,WACR1B,EAAKmB,WAAWQ,OAChB3B,EAAK4B,eAAeC,iBACpB7B,EAAKsB,SA1KD5E,EAAYE,UAAUyC,SAAS,UAEjCrC,KAAK0D,OAAYhE,EAAYE,UAAU+D,QAAQ,OAAQ,MAAK,oBAIhEf,EAAAxC,UAAA0E,SAAA,WAAA,IAAA9B,EAAAhD,KACEA,KAAK+E,OAAS,IAAIC,EAAAA,cAAc,GAChChF,KAAK+C,eAAekC,OAAOC,WAAU,SAACD,GACpCjC,EAAKQ,WAAY,EACjBR,EAAK1C,SAAW2E,EAAOE,MAEzBnF,KAAKoF,uBAAyBpF,KAAK8C,eAAe3C,cAAc+E,WAC9D,WACElC,EAAK0B,aAGT1E,KAAKqF,wBACHrF,KAAK8C,eAAe7C,iBAAiBiF,WAAU,WAC7ClC,EAAK3C,oBAETL,KAAKsF,aAAeC,EAAAA,SAAS,MAC1B3E,KAAK4E,EAAAA,UAAS,WAAM,OAAAxC,EAAKF,eAAe/B,cAAciC,EAAK1C,cAC3D4E,aAGLtC,EAAAxC,UAAAqF,gBAAA,WACEzF,KAAKK,kBAGPuC,EAAAxC,UAAAqE,YAAA,WAAA,QAAAzB,EAAAhD,KACEA,KAAK0F,QAAqB,QAAdC,EAAG3F,KAAK4F,cAAM,IAAAD,OAAA,EAAAA,EAAEE,cAAcC,WAAW,MACrD9F,KAAKmE,WAAa,IAAI4B,EAAAA,qBACpB/F,KAAK+E,OACLiB,EAAAA,SAASC,IACT,IAAIC,WACJlG,KAAKM,SACL,MACA,GACA,GACA,EACA,EACAN,KAAK6C,YAAYP,qBACjBtC,KAAK0D,QAEP1D,KAAKuE,OAAS,IAAI4B,EAAAA,WAAWnG,KAAK+E,OAAe/E,KAAK0F,SACtD1F,KAAKwE,cAAgB,IAAI4B,EAAAA,cACvBpG,KAAK+E,OACL/E,KAAKmE,WACLnE,KAAKuE,QAEPvE,KAAKqG,YAAc,IAAIC,EAAAA,YAAYtG,KAAKuE,OAAQvE,KAAKmE,WAAY,KACjEnE,KAAK4E,eAAiB,IAAI2B,EAAAA,eAAevG,KAAKuE,OAAQvE,KAAKmE,YAE3DnE,KAAKmE,WAAWqC,cAAgBxG,KAAKuE,OAAOkC,YAAYC,KAAK1G,KAAKuE,QAClEvE,KAAKmE,WAAWwC,QAAU3G,KAAKuE,OAAOqC,MAAMF,KAAK1G,KAAKuE,QACtDvE,KAAKmE,WAAW0C,WAAa7G,KAAKuE,OAAOuC,cAAcJ,KAAK1G,KAAKuE,QACjEvE,KAAKmE,WAAW4C,cAAgB/G,KAAKuE,OAAOwC,cAAcL,KAAK1G,KAAKuE,QACpEvE,KAAKmE,WAAW6C,eAAiBhH,KAAKkE,wBAAwBwC,KAAK1G,MACnEA,KAAKmE,WAAW8C,QAAUjH,KAAKkH,kBAAkBR,KAAK1G,MACtDA,KAAKuE,OAAO4C,OAASnH,KAAKmE,WAAWiD,KAAKV,KAAK1G,KAAKmE,YACpDnE,KAAKuE,OAAOiC,cAAgBxG,KAAKwE,cAAciC,YAAYC,KACzD1G,KAAKwE,eAEPxE,KAAKuE,OAAO8C,IAAMrH,KAAKyD,SACvBzD,KAAK8D,UAAYwD,EAAAA,UAAqB,QAAZC,EAACvH,KAAK4F,cAAM,IAAA2B,OAAA,EAAAA,EAAE1B,cAAe,aACvD7F,KAAK8D,UAAUlD,KAAK4G,EAAAA,aAAa,MAAMtC,WAAU,SAACuC,GACxB,MAApBzE,EAAKqD,aACPrD,EAAKqD,YAAYqB,UAAUD,OAUjC7E,EAAAxC,UAAA8G,kBAAA,WACElH,KAAKsE,SAGP1B,EAAAxC,UAAAuH,KAAA,WAAA,IAAA3E,EAAAhD,KACEA,KAAK8C,eACF/B,cAAcf,KAAKM,UACnBM,KACCC,EAAAA,YAAW,WAET,OAAO+G,EAAAA,QAETC,EAAAA,UAAS,gBAEV3C,WAAU,SAAC4C,GACV9E,EAAKK,WAAayE,EAClB9E,EAAKO,YAAcP,EAAK+E,mBACnB/E,EAAKO,aAmBRP,EAAKyB,cACLuD,YAAW,WACThF,EAAKQ,WAAY,EACjBR,EAAKiF,gBACJ,IAtBHjF,EAAKQ,WAAY,MA2BzBZ,EAAAxC,UAAAC,eAAA,WAAA,IAAA2C,EAAAhD,KACEA,KAAKwD,WAAY,EACjB0E,QAAQC,IAAI,mCACZnI,KAAK8C,eACFzC,eAAeL,KAAKM,UACpBM,KACCC,EAAAA,YAAW,WAGT,OADAmC,EAAK2E,OACEC,EAAAA,QAETC,EAAAA,UAAS,gBAEV3C,WAAU,WAAM,OAAAlC,EAAK2E,WAG1B/E,EAAAxC,UAAA6H,YAAA,WACyB,MAAnBjI,KAAKmE,aACPnE,KAAKmE,WAAWyC,MAAMwB,WACtBpI,KAAK4E,eAAeyD,iBAKxBzF,EAAAxC,UAAAkI,iBAAA,WAAA,IAAAtF,EAAAhD,KACEA,KAAK0E,UACL6D,EAAAA,MAAM,KAAMrD,WAAU,WACpBlC,EAAKiF,kBAITrF,EAAAxC,UAAA2H,iBAAA,WACE,OAAsC,IAA/B/H,KAAKqD,WAAWmF,YAkBzB5F,EAAAxC,UAAAqI,UAAA,WACMzI,KAAK6D,iBAAmB7D,KAAK4D,iBAC/B5D,KAAK4D,eAAiB5D,KAAK6D,iBAI/BjB,EAAAxC,UAAAsI,UAAA,SAAUjB,GACgB,MAApBzH,KAAKqG,aACPrG,KAAKqG,YAAYsC,QAAQlB,IAI7B7E,EAAAxC,UAAAwI,YAAA,SAAYnB,GACc,MAApBzH,KAAKqG,aACPrG,KAAKqG,YAAYwC,UAAUpB,IAI/B7E,EAAAxC,UAAA0I,YAAA,WACM9I,KAAKsF,cACPtF,KAAKsF,aAAayD,cAEpB/I,KAAK0E,UACD1E,KAAKqF,yBACPrF,KAAKqF,wBAAwB0D,cAE3B/I,KAAKoF,wBACPpF,KAAKoF,uBAAuB2D,qDAlPrBnG,GAAYtB,EAAA0H,kBAAAlH,GAAAR,EAAA0H,kBAAAlJ,GAAAwB,EAAA0H,kBAAAC,EAAAC,mDAAZtG,EAAYuG,UAAA,CAAA,CAAA,YAAAC,UAAA,SAAAC,EAAAC,wXCtCzBC,EAAAA,eAAAA,EAAAA,OACIA,EAAAA,eAAAA,EAAAA,SAAAA,GAAiCC,EAAAA,OAAAA,EAAAA,aAAQC,EAAAA,eACzCF,EAAAA,eAAAA,EAAAA,SAAAA,EAAAA,GAA8FG,EAAAA,WAAAA,WAAAA,SAAAA,GAAAA,OAAWJ,EAAAZ,UAAAiB,KAAXD,CAA6B,aAAA,SAAAC,GAAA,OAAcL,EAAAV,YAAAe,MAAqBF,EAAAA,eAClKA,EAAAA,sBADmCG,EAAAA,UAAAA,GAAAC,EAAAA,WAAAA,QAAAA,EAAAA,MAAAA,CAAe,SAAAP,EAAApG,4FDoCrCN,EAAY,CAAA,MALxBkH,EAAAA,gBAAU,CACTC,SAAU,UACVC,YAAa,uBACbC,OAAQ,wEAGgCrE,OAAM,CAAA,MAA7CsE,EAAAA,gBAAU,SAAU,CAAEC,QAAQ,MAKflH,MAAK,CAAA,MAApBmH,EAAAA,QACelH,OAAM,CAAA,MAArBkH,EAAAA,QACSjH,YAAW,CAAA,MAApBkH,EAAAA,SACSjH,aAAY,CAAA,MAArBiH,EAAAA,WEzCH,IAAAC,EAAA,WAEE,SAAAA,YAEAA,EAAAlK,UAAA0E,SAAA,eAJF,oCAAawF,qCAAAA,EAAsBnB,UAAA,CAAA,CAAA,uBAAAoB,MAAA,EAAAC,KAAA,EAAAC,SAAA,SAAApB,EAAAC,SCPnCC,EAAAA,eAAAA,EAAAA,OAAKC,EAAAA,OAAAA,EAAAA,kBAAcC,EAAAA,eACnBF,EAAAA,eAAAA,EAAAA,OAAKC,EAAAA,OAAAA,EAAAA,QAAIC,EAAAA,eACTF,EAAAA,eAAAA,EAAAA,UAAQC,EAAAA,OAAAA,EAAAA,MAAEC,EAAAA,+FDKGa,EAAsB,CAAA,MALlCR,EAAAA,gBAAU,CACTC,SAAU,qBACVC,YAAa,kCACbU,UAAW,CAAC,yEEUd,8CAAaC,oCAAAA,yCAFA,CAAC7I,EAAahC,GAAW8K,QAAA,CAH3B,CAACC,EAAAA,iBAAkBC,EAAAA,mFAKjBH,EAAS,CAAAI,aAAA,CANLnI,EAAc0H,GAAsBM,QAAA,CACzCC,EAAAA,iBAAkBC,EAAAA,eAAaE,QAAA,CAC/BpI,qEAIC+H,EAAS,CAAA,MAPrBM,EAAAA,eAAS,CACRF,aAAc,CAACnI,EAAc0H,GAC7BM,QAAS,CAACC,EAAAA,iBAAkBC,EAAAA,eAC5BE,QAAS,CAACpI,GACVsI,QAAS,CAACC,EAAAA,wBACVC,UAAW,CAACtJ,EAAahC","sourcesContent":["export const environment = {\r\n    production: false,\r\n    mpsServer: 'https://localhost/mps',\r\n    rpsServer: 'https://localhost/rps' \r\n}","import { HttpClient } from '@angular/common/http';\nimport { EventEmitter, Injectable } from '@angular/core';\nimport { Observable } from 'rxjs';\nimport { catchError } from 'rxjs/operators';\nimport { environment } from '../environments/environment';\nimport { AmtFeaturesResponse, PowerState } from '../models/models';\n\n@Injectable({\n  providedIn: 'platform',\n})\nexport class KvmService {\n  connectKVMSocket: EventEmitter<boolean> = new EventEmitter<boolean>(false);\n  stopwebSocket: EventEmitter<boolean> = new EventEmitter<boolean>(false);\n\n  constructor(private readonly http: HttpClient) {}\n\n  setAmtFeatures(deviceId: string): Observable<AmtFeaturesResponse> {\n    const payload = {\n      userConsent: 'none',\n      enableKVM: true,\n      enableSOL: true,\n      enableIDER: true,\n    };\n    return this.http\n      .post<AmtFeaturesResponse>(\n        `${environment.mpsServer}/api/v1/amt/features/${deviceId}`,\n        payload\n      )\n      .pipe(\n        catchError((err) => {\n          throw err;\n        })\n      );\n  }\n  getPowerState(deviceId: string): Observable<PowerState> {\n    return this.http\n      .get<PowerState>(\n        `${environment.mpsServer}/api/v1/amt/power/state/${deviceId}`\n      )\n      .pipe(\n        catchError((err) => {\n          throw err;\n        })\n      );\n  }\n  sendPowerAction(\n    deviceId: string,\n    action: number,\n    useSOL: boolean = false\n  ): Observable<any> {\n    const payload = {\n      method: 'PowerAction',\n      action,\n      useSOL,\n    };\n    return this.http\n      .post<any>(\n        `${environment.mpsServer}/api/v1/amt/power/action/${deviceId}`,\n        payload\n      )\n      .pipe(\n        catchError((err) => {\n          throw err;\n        })\n      );\n  }\n}\n","import { HttpClient } from '@angular/common/http';\r\nimport { EventEmitter, Injectable } from '@angular/core';\r\nimport { environment } from '../environments/environment';\r\n\r\n@Injectable({\r\n  providedIn: 'platform',\r\n})\r\nexport class AuthService {\r\n  loggedInSubject: EventEmitter<boolean> = new EventEmitter<boolean>(false);\r\n  isLoggedIn = false;\r\n  url: string = `${environment.mpsServer}/api/v1/authorize`;\r\n\r\n  constructor(private readonly http: HttpClient) {\r\n    if (localStorage.loggedInUser != null) {\r\n      this.isLoggedIn = true;\r\n      this.loggedInSubject.next(this.isLoggedIn);\r\n    }\r\n    if (environment.mpsServer.includes('/mps')) {\r\n      // handles kong route\r\n      this.url = `${environment.mpsServer}/login/api/v1/authorize`;\r\n    }\r\n  }\r\n\r\n  getLoggedUserToken(): string {\r\n    const loggedUser: any = localStorage.getItem('loggedInUser');\r\n    const token: string = JSON.parse(loggedUser).token;\r\n    return token;\r\n  }\r\n}\r\n","import {\n  AfterViewInit,\n  Component,\n  ElementRef,\n  EventEmitter,\n  Input,\n  OnDestroy,\n  OnInit,\n  Output,\n  ViewChild,\n} from '@angular/core';\nimport {\n  AMTDesktop,\n  AMTKvmDataRedirector,\n  ConsoleLogger,\n  DataProcessor,\n  IDataProcessor,\n  ILogger,\n  KeyBoardHelper,\n  MouseHelper,\n  Protocol,\n} from '@open-amt-cloud-toolkit/ui-toolkit/core';\nimport { environment } from '../environments/environment';\n// import { ActivatedRoute } from '@angular/router';\nimport { KvmService } from './kvm.service';\nimport { fromEvent, interval, of, Subscription, timer } from 'rxjs';\nimport { catchError, finalize, mergeMap, throttleTime } from 'rxjs/operators';\n// import { MatDialog } from '@angular/material/dialog';\n// import { MatSnackBar } from '@angular/material/snack-bar';\n// import { PowerUpAlertComponent } from './shared/power-up-alert/power-up-alert.component';\n// import SnackbarDefaults from './shared/config/snackBarDefault';\nimport { AuthService } from './auth.service'\nimport { ActivatedRoute } from '@angular/router';\n\n@Component({\n  selector: 'amt-kvm',\n  templateUrl: './kvm.component.html',\n  styles: [],\n})\nexport class KvmComponent implements OnInit, AfterViewInit, OnDestroy {\n  @ViewChild('canvas', { static: false }) canvas: ElementRef | undefined;\n  public context!: CanvasRenderingContext2D;\n\n  // //setting a width and height for the canvas\n\n  @Input() public width = 400;\n  @Input() public height = 400;\n  @Output() deviceState: number = 0;\n  @Output() deviceStatus: EventEmitter<number> = new EventEmitter<number>();\n  stopSocketSubscription!: Subscription;\n  startSocketSubscription!: Subscription;\n  module: any;\n  redirector: any;\n  dataProcessor!: IDataProcessor | null;\n  mouseHelper!: MouseHelper;\n  keyboardHelper!: KeyBoardHelper;\n  logger!: ILogger;\n  powerState: any = 0;\n  btnText: string = 'Disconnect';\n  isPoweredOn: boolean = false;\n  isLoading: boolean = false;\n  deviceId: string = '';\n  selected: number = 1;\n  timeInterval!: any;\n  server: string = `${environment.mpsServer.replace('http', 'ws')}/relay`;\n  previousAction = 'kvm';\n  selectedAction = '';\n  mouseMove: any = null;\n\n  encodings = [\n    { value: 1, viewValue: 'RLE 8' },\n    { value: 2, viewValue: 'RLE 16' },\n  ];\n\n  constructor(\n    // public snackBar: MatSnackBar,\n    // public dialog: MatDialog,\n    private readonly authService: AuthService,\n    private readonly devicesService: KvmService,\n    public readonly activatedRoute: ActivatedRoute\n  ) {\n    if (environment.mpsServer.includes('/mps')) {\n      //handles kong route\n      this.server = `${environment.mpsServer.replace('http', 'ws')}/ws/relay`;\n    }\n  }\n\n  ngOnInit(): void {\n    this.logger = new ConsoleLogger(1);\n    this.activatedRoute.params.subscribe((params) => {\n      this.isLoading = true;\n      this.deviceId = params.id;\n    });\n    this.stopSocketSubscription = this.devicesService.stopwebSocket.subscribe(\n      () => {\n        this.stopKvm();\n      }\n    );\n    this.startSocketSubscription =\n      this.devicesService.connectKVMSocket.subscribe(() => {\n        this.setAmtFeatures();\n      });\n    this.timeInterval = interval(15000)\n      .pipe(mergeMap(() => this.devicesService.getPowerState(this.deviceId)))\n      .subscribe();\n  }\n\n  ngAfterViewInit(): void {\n    this.setAmtFeatures();\n  }\n\n  instantiate(): void {\n    this.context = this.canvas?.nativeElement.getContext('2d');\n    this.redirector = new AMTKvmDataRedirector(\n      this.logger,\n      Protocol.KVM,\n      new FileReader(),\n      this.deviceId,\n      16994,\n      '',\n      '',\n      0,\n      0,\n      this.authService.getLoggedUserToken(),\n      this.server\n    );\n    this.module = new AMTDesktop(this.logger as any, this.context);\n    this.dataProcessor = new DataProcessor(\n      this.logger,\n      this.redirector,\n      this.module\n    );\n    this.mouseHelper = new MouseHelper(this.module, this.redirector, 200);\n    this.keyboardHelper = new KeyBoardHelper(this.module, this.redirector);\n\n    this.redirector.onProcessData = this.module.processData.bind(this.module);\n    this.redirector.onStart = this.module.start.bind(this.module);\n    this.redirector.onNewState = this.module.onStateChange.bind(this.module);\n    this.redirector.onSendKvmData = this.module.onSendKvmData.bind(this.module);\n    this.redirector.onStateChanged = this.onConnectionStateChange.bind(this);\n    this.redirector.onError = this.onRedirectorError.bind(this);\n    this.module.onSend = this.redirector.send.bind(this.redirector);\n    this.module.onProcessData = this.dataProcessor.processData.bind(\n      this.dataProcessor\n    );\n    this.module.bpp = this.selected;\n    this.mouseMove = fromEvent(this.canvas?.nativeElement, 'mousemove');\n    this.mouseMove.pipe(throttleTime(200)).subscribe((event: any) => {\n      if (this.mouseHelper != null) {\n        this.mouseHelper.mousemove(event);\n      }\n    });\n  }\n\n  onConnectionStateChange = (redirector: any, state: number): any => {\n    this.deviceState = state;\n    this.deviceStatus.emit(state);\n  };\n\n  onRedirectorError(): void {\n    this.reset();\n  }\n\n  init(): void {\n    this.devicesService\n      .getPowerState(this.deviceId)\n      .pipe(\n        catchError(() => {\n          // this.snackBar.open(`Error retrieving power status`, undefined, SnackbarDefaults.defaultError)\n          return of();\n        }),\n        finalize(() => {})\n      )\n      .subscribe((data) => {\n        this.powerState = data;\n        this.isPoweredOn = this.checkPowerStatus();\n        if (!this.isPoweredOn) {\n          this.isLoading = false;\n          // const dialog = this.dialog.open(PowerUpAlertComponent);\n          // dialog.afterClosed().subscribe((result) => {\n          //   if (result) {\n          //     this.isLoading = true;\n          //     this.devicesService\n          //       .sendPowerAction(this.deviceId, 2)\n          //       .pipe()\n          //       .subscribe((data) => {\n          //         this.instantiate();\n          //         setTimeout(() => {\n          //           this.isLoading = false;\n          //           this.autoConnect();\n          //         }, 4000);\n          //       });\n          //   }\n          // });\n        } else {\n          this.instantiate();\n          setTimeout(() => {\n            this.isLoading = false;\n            this.autoConnect();\n          }, 0);\n        }\n      });\n  }\n\n  setAmtFeatures(): void {\n    this.isLoading = true;\n    console.log('coming inside in setAmtfeatures');\n    this.devicesService\n      .setAmtFeatures(this.deviceId)\n      .pipe(\n        catchError(() => {\n          // this.snackBar.open(`Error enabling kvm`, undefined, SnackbarDefaults.defaultError)\n          this.init();\n          return of();\n        }),\n        finalize(() => {})\n      )\n      .subscribe(() => this.init());\n  }\n\n  autoConnect(): void {\n    if (this.redirector != null) {\n      this.redirector.start(WebSocket);\n      this.keyboardHelper.GrabKeyInput();\n    }\n  }\n\n  \n  onEncodingChange (): void {\n    this.stopKvm()\n    timer(1000).subscribe(() => {\n      this.autoConnect()\n    })\n  }\n\n  checkPowerStatus(): boolean {\n    return this.powerState.powerstate === 2;\n  }\n\n  reset = (): void => {\n    this.redirector = null;\n    this.module = null;\n    this.dataProcessor = null;\n    this.height = 400;\n    this.width = 400;\n    this.instantiate();\n  };\n\n  stopKvm = (): void => {\n    this.redirector.stop();\n    this.keyboardHelper.UnGrabKeyInput();\n    this.reset();\n  };\n\n  ngDoCheck(): void {\n    if (this.selectedAction !== this.previousAction) {\n      this.previousAction = this.selectedAction;\n    }\n  }\n\n  onMouseup(event: MouseEvent): void {\n    if (this.mouseHelper != null) {\n      this.mouseHelper.mouseup(event);\n    }\n  }\n\n  onMousedown(event: MouseEvent): void {\n    if (this.mouseHelper != null) {\n      this.mouseHelper.mousedown(event);\n    }\n  }\n\n  ngOnDestroy (): void {\n    if (this.timeInterval) {\n      this.timeInterval.unsubscribe()\n    }\n    this.stopKvm()\n    if (this.startSocketSubscription) {\n      this.startSocketSubscription.unsubscribe()\n    }\n    if (this.stopSocketSubscription) {\n      this.stopSocketSubscription.unsubscribe()\n    }\n  }\n}\n","<!-- <amt-device-toolbar></amt-device-toolbar> -->\r\n<div>\r\n    <button style=\"display: block;\"> connect </button>\r\n    <canvas class=\"canvas\" #canvas [width]=\"width\" [height]=\"height\" oncontextmenu=\"return false\" (mouseup)=\"onMouseup($event)\" (mousedown)=\"onMousedown($event)\"></canvas>\r\n</div>\r\n\r\n","import { Component, OnInit } from '@angular/core';\n\n@Component({\n  selector: 'amt-device-toolbar',\n  templateUrl: './device-toolbar.component.html',\n  styleUrls: ['./device-toolbar.component.css']\n})\nexport class DeviceToolbarComponent implements OnInit {\n\n  constructor() { }\n\n  ngOnInit(): void {\n  }\n\n}\n","<div>Device Control</div>\n<div>List</div>\n<button>tv</button>","import { NgModule, CUSTOM_ELEMENTS_SCHEMA } from '@angular/core';\nimport { BrowserModule } from '@angular/platform-browser';\nimport { KvmComponent } from './kvm.component';\nimport { DeviceToolbarComponent } from './app/device-toolbar/device-toolbar.component';\nimport { HttpClientModule } from '@angular/common/http';\nimport { AuthService } from './auth.service';\nimport { KvmService } from './kvm.service';\n\n@NgModule({\n  declarations: [KvmComponent, DeviceToolbarComponent],\n  imports: [HttpClientModule, BrowserModule],\n  exports: [KvmComponent],\n  schemas: [CUSTOM_ELEMENTS_SCHEMA],\n  providers: [AuthService, KvmService],\n})\nexport class KvmModule {}\n"]}